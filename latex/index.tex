\chapter{ðŸŒŠ Sailfish pool (sfpool)}
\hypertarget{index}{}\label{index}\index{ðŸŒŠ Sailfish pool (sfpool)@{ðŸŒŠ Sailfish pool (sfpool)}}
\label{index_md_README}%
\Hypertarget{index_md_README}%




This is a lightweight pool manager for small memory allocations in C, optimized for data privacy and speed.

It does not work as a drop-\/in replacement of memory functions using the "{}\+LD\+\_\+\+PRELOAD trick"{}) because it also requires initialization and teardown.

Also a single sfpool cannot share concurrent memory access\+: multi-\/threaded applications should create and initialize a different sfpool for each running thread.\hypertarget{index_autotoc_md0}{}\doxysubsection{\texorpdfstring{Features}{Features}}\label{index_autotoc_md0}

\begin{DoxyItemize}
\item {\bfseries{Portable}}\+: Tested to run on 32 and 64 bit targets\+: Apple/\+OSX and MS/\+Windows, ARM and x86 as well WASM
\item {\bfseries{Fast}}\+: Efficiently manages small, fixed-\/size memory blocks using a preallocated memory pool.
\item {\bfseries{Private}}\+: Ensures memory access is locked whenever possible and contents deleted on release.
\item {\bfseries{Transparent}}\+: Supports {\ttfamily realloc()} for transparent transition to system alloc on big sizes.
\item {\bfseries{Steady}}\+: Hashtable lookup on allocated memory grants O(1) constant time operations.
\item {\bfseries{Fallback}}\+: Resorts to system {\ttfamily malloc()} when pool is exhausted to continue functioning.
\end{DoxyItemize}\hypertarget{index_autotoc_md1}{}\doxysubsection{\texorpdfstring{Intended use case}{Intended use case}}\label{index_autotoc_md1}
The primary use case for ðŸŒŠ sailfish-\/pool is within \href{https://zenroo.org}{\texttt{ Zenroom}}, our small virtual machine (VM) designed for cryptographic operations where Lua is embedded.

Zenroom\textquotesingle{}s main target is Web\+Assembly (WASM), which \href{https://forkbomb.solutions}{\texttt{ we extensively use at work}} to simplify end-\/to-\/end encryption. This explains the 32-\/bit support of this allocator.

In Zenroom, a significant amount of small memory allocations occur, typically involving octets for hashes, elliptic curve points, cryptographic keys, zero-\/knowledge proofs, and other cryptographic operations. These allocations frequently have sizes below 256 bytes. As cryptographic algorithms evolve, particularly with the advent of post-\/quantum cryptography, the pool size can be fine-\/tuned to accommodate these growing requirements.\hypertarget{index_autotoc_md2}{}\doxysubsection{\texorpdfstring{Usage}{Usage}}\label{index_autotoc_md2}
To use the custom memory manager in your project, include {\ttfamily \doxylink{sfpool_8h_source}{sfpool.\+h}} and use the provided functions.\hypertarget{index_autotoc_md3}{}\doxysubsubsection{\texorpdfstring{$<$a href="{}https\+://dyne.\+org/sailfish-\/pool/group\+\_\+\+\_\+sfpool.\+html"{} $>$\+High Level API$<$/a$>$}{<a href="https://dyne.org/sailfish-pool/group\_\_sfpool.html" >High Level API</a>}}\label{index_autotoc_md3}
The main entry point is \href{https://dyne.org/sailfish-pool/group__sfpool.html}{\texttt{ ðŸŒŠ documented here}} and constituted by init/teardown functions initalizing an sfpool context and malloc/free/realloc functions for common memory operations. Also a function to verify if a pointer is contained in the pool and one to report status.\hypertarget{index_autotoc_md4}{}\doxysubsubsection{\texorpdfstring{$<$a href="{}https\+://dyne.\+org/sailfish-\/pool/group\+\_\+\+\_\+sfutil.\+html"{} $>$\+Utilities API$<$/a$>$}{<a href="https://dyne.org/sailfish-pool/group\_\_sfutil.html" >Utilities API</a>}}\label{index_autotoc_md4}
Some internal functions are exposed as they may be useful also to host applications\+: fast and portable memory zeroing, memory alignment and the internal portable implementations for secure allocation and free.\hypertarget{index_autotoc_md5}{}\doxysubsection{\texorpdfstring{Testing}{Testing}}\label{index_autotoc_md5}
There is a makefile target in this repository running tests with the address sanitizer\+: just type {\ttfamily make}.

To run these tests inside your source you can always do\+: \begin{DoxyVerb}gcc -D SFPOOL_TEST -o sfpool_test sfpool.c
time ./sfpool_test
\end{DoxyVerb}
 The test suite will allocate and deallocate memory in various patterns to simulate different usage scenarios and assert the correctness of the memory management.\hypertarget{index_autotoc_md6}{}\doxysubsection{\texorpdfstring{License}{License}}\label{index_autotoc_md6}
Copyright (C) 2025 Dyne.\+org foundation

Designed and written by Denis "{}\mbox{[}\+Jaromil\mbox{]}(https\+://jaromil.\+dyne.\+org)"{} Roio

This program is free software\+: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License along with this program. If not, see \href{https://www.gnu.org/licenses/}{\texttt{ https\+://www.\+gnu.\+org/licenses/}}.

\href{http://www.dyne.org}{\texttt{ }} 